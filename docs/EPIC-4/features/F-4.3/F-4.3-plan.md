# Feature Plan: F-4.3 - Orbital Lock-On (Globe Interactivity)

## üèîÔ∏è Overview
This feature implements the core orbital mechanics that transform the COBE globe from a passive display into an interactive **Satellite Targeting System**. When users select adventures from the Tactical Archive, the globe performs a fluid "lock-on" sequence, rotating to precisely align with the target coordinates using spring-based physics for organic, satellite-like movement.

## üéØ Core Interaction Mechanics

### Target Lock Sequence
1. **Selection Trigger**: User clicks adventure item in Tactical Archive
2. **Coordinate Calculation**: Convert LAT/LON to COBE globe rotation angles
3. **Orbital Maneuver**: Spring-based rotation to target position
4. **Lock Confirmation**: Visual "Target Acquired" feedback with coordinate display
5. **Target Marker**: Visual indicator appears on globe surface

### Visual Feedback System
- **Lock Animation**: Smooth, satellite-like rotation using COBE's native onRender interpolation (shortest-path calculation)
- **Target Marker**: Pulsing "X" or reticle overlay on globe surface at target location
- **Coordinate Sync**: Real-time LAT/LON updates during rotation
- **Status Updates**: Footer status transitions from `TARGET_ACQUIRING` to `TARGET_LOCKED` based on distance threshold

## üó∫Ô∏è Layout & Wireframes

### Initial State (No Target Selected)
```text
+-------------------------------------------------------------+
| [ ADVENTURES ]                            (o) STATUS: ONLINE |
+-----------------------+-------------------------------------+
|                       |                                     |
|  [ TACTICAL_ARCHIVE ] |  [ GLOBAL_RECON_FEED ]              |
|  ------------------   |  LAT: --.-- / LON: --.--            |
|                       |                                     |
|  > [ VERTICAL_OPS ]   |            /-------------\          |
|    > JOSHUA TREE      |           /       .       \         |
|    > RED ROCKS        |          |    .  GLOBE  .  |        |
|    > MALLORCA         |           \       .       /         |
|    > ARCO             |            \-------------/          |
|    > RAILAY           |                                     |
|    > DEDO DE DEUS     |                                     |
|    > CHAPADA          |                                     |
|  v [ ALPINE_OPS ]     |                                     |
|    > HUAYNA POTOSI    |                                     |
|    > WYOMING          |                                     |
|  > [ OVERLAND_OPS ]   |                                     |
|                       |                                     |
+-----------------------+-------------------------------------+
| READY_TO_SCAN // STABLE_SIGNAL                      CONTACT |
| SCAN_SYSTEM // ACTIVE                 (W) (T) (I) (G) (E)    |
+-------------------------------------------------------------+
```

### Target Acquisition (Animation In Progress)
```text
+-------------------------------------------------------------+
| [ ADVENTURES ]                            (o) STATUS: ONLINE |
+-----------------------+-------------------------------------+
|                       |                                     |
|  [ TACTICAL_ARCHIVE ] |  [ GLOBAL_RECON_FEED ]              |
|  ------------------   |  LAT: 16.27S / LON: 68.12W          |
|                       |                                     |
|  > [ VERTICAL_OPS ]   |            /        ‚Üó      \        |
|    > JOSHUA TREE      |           /    ‚Üó   (X)    |       |
|    > RED ROCKS        |          |    GLOBE.      |        |
|    > MALLORCA         |           \        ‚Üò      /         |
|    > ARCO             |            \-------------/          |
|    > RAILAY           |              [ROTATING...]           |
|    > DEDO DE DEUS     |                                     |
|    > CHAPADA          |                                     |
|  v [ ALPINE_OPS ]     |                                     |
|    [*] HUAYNA POTOSI  |                                     |
|    > WYOMING          |                                     |
|  > [ OVERLAND_OPS ]   |                                     |
|                       |                                     |
+-----------------------+-------------------------------------+
| TARGET_ACQUIRING // BOLIVIA_POTOSI                   CONTACT |
| ORBITAL_MANEUVER // ACTIVE             (W) (T) (I) (G) (E)    |
+-------------------------------------------------------------+
```

### Target Locked (Final State)
```text
+-------------------------------------------------------------+
| [ ADVENTURES ]                            (o) STATUS: ONLINE |
+-----------------------+-------------------------------------+
|                       |                                     |
|  [ TACTICAL_ARCHIVE ] |  [ GLOBAL_RECON_FEED ]              |
|  ------------------   |  LAT: 16.27S / LON: 68.12W          |
|                       |                                     |
|  > [ VERTICAL_OPS ]   |            /        |      \        |
|    > JOSHUA TREE      |           |    -- (X) --    |       |
|    > RED ROCKS        |           |         |       |       |
|    > MALLORCA         |           \               /        |
|    > ARCO             |            \-------------/         |
|    > RAILAY           |                                     |
|    > DEDO DE DEUS     |                                     |
|    > CHAPADA          |                                     |
|  v [ ALPINE_OPS ]     |                                     |
|    [*] HUAYNA POTOSI  |                                     |
|    > WYOMING          |                                     |
|  > [ OVERLAND_OPS ]   |                                     |
|                       |                                     |
+-----------------------+-------------------------------------+
| TARGET_LOCKED // BOLIVIA_POTOSI                       CONTACT |
| COORDINATE_LOCK // ACTIVE                 (W) (T) (I) (G) (E)    |
+-------------------------------------------------------------+
```

### Target Marker Detail (Globe Surface)
```text
       Target Marker (Zoomed View)
       
           , - ~ ~ ~ - ,
      , '   (X) LOCKED   ' ,
    ,                         ,
   ,     ‚Üñ  RETICLE  ‚Üó       ,
   ,      ‚Üó   PULSE   ‚Üñ      ,
    ,   PULSE EFFECT   ,    
     ' , - _ _ _ _ _ , '
```

### Mobile Target Lock Sequence
```text
+-----------------------------+
| [ P.Z ]     (o) STATUS: ON  |
+-----------------------------+
|                             |
|      [ GLOBAL_RECON ]       |
|  LAT: 16.27S / LON: 68.12W  |
|                             |
|       /        ‚Üó      \     |
|      /    ‚Üó   (X)    |    |
|     |    GLOBE.      |     |
|      \        ‚Üò      /     |
|       \-------------/      |
|      [ROTATING...]         |
|                             |
| LOG: LOCKING...  (W)(T)(I)(G)|
+-----------------------------+

+-----------------------------+
| [ P.Z ]     (o) STATUS: ON  |
+-----------------------------+
|                             |
|      [ GLOBAL_RECON ]       |
|  LAT: 16.27S / LON: 68.12W  |
|                             |
|       /        |      \     |
|      /    -- (X) --    |    |
|     |         |       |     |
|      \               /     |
|       \-------------/      |
|      [LOCKED]             |
|                             |
| LOG: TARGET_LOCKED (W)(T)(I)(G)|
+-----------------------------+
```

## üîÑ Animation Sequence Details

### Lock-On Animation Flow
```text
T=0.0s (Click):
‚îå‚îÄ> User selects adventure
‚îÇ   ‚îî‚îÄ> Sidebar item changes to [*] (instant)
‚îî‚îÄ> focusRef.current = locationToAngles(lat, long)

T=0.1s:
‚îå‚îÄ> Footer status: "TARGET_ACQUIRING..."
‚îÇ   ‚îî‚îÄ> LAT/LON display starts updating
‚îî‚îÄ> COBE onRender begins rotation animation

T=0.1s - 2.0s:
‚îå‚îÄ> Globe smoothly rotates using distance-based speed
‚îÇ   ‚îî‚îÄ> currentPhi/currentTheta approach target angles
‚îî‚îÄ> Coordinate values update in real-time

T=2.0s:
‚îå‚îÄ> Globe locks into position (distPositive/distNegative ‚âà 0)
‚îÇ   ‚îî‚îÄ> Target marker appears at exact location
‚îî‚îÄ> Footer status: "TARGET_LOCKED"

T=2.1s:
‚îå‚îÄ> System enters "COORDINATE_LOCK // ACTIVE"
‚îÇ   ‚îî‚îÄ> All animations complete
‚îî‚îÄ> Ready for next interaction
```

### Target Marker Animation States
```text
State 1: Fading In      State 2: Pulsing      State 3: Locked
   ( )                   (X)                 (X)
   ‚Üó  ‚Üñ                 ‚Üó  ‚Üñ                 ‚Üó  ‚Üñ
  (X)                  (X)LOCKED          (X)LOCKED
   ‚Üñ  ‚Üó                 ‚Üñ  ‚Üó                 ‚Üñ  ‚Üó
   ( )                   (X)                 (X)
Opacity: 0‚Üí1            Pulse: 1‚Üí1.3‚Üí1       Solid: 1.0
```

## üõ†Ô∏è Implementation Strategy

### 1. Coordinate Mapping System
- **LAT/LON to COBE**: Convert geographic coordinates to globe rotation angles using `locationToAngles(lat, long)`
- **Formula**: `return [Math.PI - ((long * Math.PI) / 180 - Math.PI / 2), (lat * Math.PI) / 180]`
- **Target Database**: Pre-calculated rotation angles for all 13 adventures
- **Precision Targeting**: Ensure markers align accurately with surface positions

### 1.1 Globe Rotation Animation Implementation
- **focusRef**: React ref to store target rotation angles `[focusPhi, focusTheta]`
- **Animation Controller**: Smooth interpolation using distance-based speed control
- **Rotation Logic**: 
  - Calculate shortest path: compare `distPositive` vs `distNegative`
  - Apply rotation: `currentPhi += distPositive * 0.08` or `currentPhi -= distNegative * 0.08`
  - Smooth theta interpolation: `currentTheta = currentTheta * 0.92 + focusTheta * 0.08`
- **Idle Drift**: If no target is selected, `currentPhi` increases by a constant drift factor (`0.003`) per frame
- **Speed Control**: `0.08` factor controls rotation speed for realistic satellite movement

### 2. Rotation Animation Integration
- **Cobe onRender**: Leverage COBE's built-in render loop for smooth animation
- **Distance-Based Speed**: Automatic shortest path calculation for optimal rotation
- **Continuous Animation**: Real-time rotation updates during each frame
- **Performance Optimized**: Uses COBE's native animation system for 60fps performance

### 3. Selection Handler Integration
- **Adventure Click**: Trigger rotation by updating `focusRef.current = locationToAngles(lat, long)`
- **Immediate Response**: Sidebar selection changes to `[*]` instantly
- **Coordinate Sync**: LAT/LON display updates during rotation process
- **Status Pulse**: Detect lock completion when `dist < 0.01` to transition status to "TARGET_LOCKED"

### 3.1 Visual Feedback Layer
- **Target Markers**: COBE markers array updated with adventure locations
- **Reticle Animations**: Multi-stage targeting visual effects
- **Status Synchronization**: Coordinate all UI elements with rotation

### 4. Globe Component Structure
- **Cobe Component**: Main globe component with rotation logic
- **Location Mapping**: Pre-configured adventure coordinates with `locationToAngles` conversion
- **Rotation Control**: `focusRef.current` updates trigger automatic rotation
- **Adventure Integration**: Each adventure click calls rotation handler with specific coordinates

### 4.1 Interaction States
- **Idle State**: Globe in continuous drift, no targets locked
- **Acquiring State**: Rotation in progress, coordinates updating
- **Locked State**: Target engaged, marker visible, system stable

### 5. Mobile Optimization
- **Touch Targets**: Ensure adventure selection works reliably on mobile
- **Globe Performance**: Optimize rotation animations for mobile processors
- **Responsive Markers**: Target markers scale appropriately on small screens

## ‚úÖ Acceptance Criteria

### Desktop Functionality
- [x] Clicking any adventure item triggers smooth globe rotation
- [x] LAT/LON coordinates update dynamically during rotation
- [x] Target marker appears precisely at adventure location on globe
- [x] Footer status updates: "TARGET_ACQUIRING" ‚Üí "TARGET_LOCKED"
- [x] Selected adventure shows `[*]` indicator in sidebar
- [x] Rotation physics feel natural and satellite-like (not robotic)
- [x] Multiple target selections work sequentially

### Mobile Functionality
- [x] Touch interactions trigger lock-on sequence reliably
- [x] Globe rotation performs smoothly on mobile devices
- [x] Target markers remain visible and properly sized on mobile
- [x] Coordinate display updates correctly in mobile layout
- [x] Mobile adventure selector integrates with lock-on system

### Visual Consistency
- [x] Target markers use Alpine Blue color scheme
- [x] Animation timing matches established interface patterns
- [x] Status messages follow terminal aesthetic conventions
- [x] Globe surface markers maintain visual clarity
- [x] Reticle effects enhance tactical feel without cluttering

### Performance & Accessibility
- [x] Rotation animations maintain 60fps on all devices
- [x] Coordinate calculations complete within 100ms
- [x] Keyboard navigation supported for adventure selection
- [x] Screen reader announcements for status changes
- [x] Reduced motion options respected for accessibility